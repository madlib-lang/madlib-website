import type { Element } from "MadUI"

import type { Content, State } from "./State"

import { Left, Right } from "Either"
import { parse } from "JsonParser"
import {} from "List"

import { DEFAULT_CONFIG, renderWithConfig } from "MadUI"

import { DEFAULT_CONTENT, INITIAL_STATE, Loading, Transitioning } from "./State"
import { contentParser } from "@client/Parsers"
import json from "@client/content.json"
import { SplashScreen } from "@client/views/SplashScreen"



RenderPage :: (State -> Element State) -> State -> Element State
export RenderPage = (ToRender, state) => state.loadingState
  == Loading
  || state.loadingState
  == Transitioning
  ? SplashScreen(state.loadingState)
  : ToRender(state)


parseContent :: String -> Content
parseContent = pipe(
  parse(contentParser),
  where {
    Right(c) =>
      c

    Left(_) =>
      DEFAULT_CONTENT
  },
)


renderer :: (State -> Element State) -> {}
export renderer = (Renderable) => renderWithConfig(
  DEFAULT_CONFIG,
  RenderPage(Renderable),
  { ...INITIAL_STATE, content: parseContent(json) },
  "app",
)
